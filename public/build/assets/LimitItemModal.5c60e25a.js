import"https://checkout.razorpay.com/v1/checkout.js";import me from"./PsModal.20834757.js";import de from"./PsLabel.3cf95094.js";import ce from"./PsButton.bc5ed803.js";import ue from"./PsRadio.3dac062e.js";import fe from"./PsRadio2.bd18197c.js";import _e from"./PsErrorDialog.cf13beac.js";import ye from"./PsWarningDialog2.c788b92c.js";import ge from"./PsIcon.dc31c2db.js";import be from"./StripePaymentModal.e7165d18.js";import ve from"./PaypalPaymentModal.04fe35bc.js";import ke from"./OfflinePaymentModal.bcd67836.js";import Pe from"./InputEmailModal.a3d18bf5.js";import{u as he}from"./AppInfoStore.266a6525.js";import{P as Se}from"./PsValueStore.a232cbb1.js";import{u as Ae}from"./UserStore.ecd89ebd.js";import{u as Ie}from"./PackageStore.da95ec7c.js";import{I as we}from"./ItemLimitParameterHolder.6c72602a.js";import{A as Ee}from"./AppInfoParameterHolder.e24d894d.js";import{u as Ce}from"./LimitAdItemStore.a425d616.js";import{u as Te}from"./ItemPromotionStore.cb9e40e2.js";import{b as Me}from"./PsApiService.98e573c3.js";import{d as Fe,i as y,o as v,c as re,b as i,w as l,a as c,f as w,q as h,t as k,g as L,F as Le,s as Ne,n as $e,m as V,B as u,bJ as Re,r as g,E as Oe}from"./app.0e502cc5.js";import{P as E}from"./ps_constants.0e2a11f9.js";import{s as ne}from"./inline.d0ef9675.js";import{P as C}from"./PsUtils.78b0d4de.js";import{f as Ue}from"./format.min.502eec0f.js";import{_ as De}from"./plugin-vue_export-helper.21dcd24c.js";import"./vue-neat-modal.d03c5dee.js";import"./PsLine.4597488d.js";import"./stripe.esm.2a0d6725.js";import"./PsLabelHeader4.fc9d9bf1.js";import"./PsErrorDialog.092191b2.js";import"./PsLabelTitle.41617619.js";import"./PsLoadingDialog.e4058754.js";import"./TokenStore.222ad207.js";import"./ApiStatus.5720ba0b.js";import"./PsObject.a17ef38f.js";import"./PsSepetetedStore.9a31ac47.js";import"./dropin.4ee2cd7a.js";import"./PsLabelTitle3.bf9bb1e2.js";import"./PsLabelHeader6.d6849b88.js";import"./OfflinePaymentStore.12bcb16f.js";import"./DefaultIcon.e76b39a5.js";import"./PsInput.e5044849.js";import"./DefaultPhoto.cc755f93.js";import"./User.0c3ba1a8.js";import"./RatingDetail.291ad5d1.js";import"./ProductRelation.0b376978.js";import"./UserListParameterHolder.d110b747.js";import"./Package.5254ef20.js";import"./PaymentInfo.5aa268a0.js";import"./LimitAdTransaction.68a62e95.js";import"./Product.29c94914.js";import"./Category.7c65464b.js";import"./SubCategory.1b4176e0.js";import"./ItemCurrency.91c8ce91.js";import"./ItemLocation.d1b92a80.js";import"./Vendor.d946ee87.js";const Ve=Fe({name:"LimitItemModal",components:{PsModal:me,PsIcon:ge,PsLabel:de,PsButton:ce,PsErrorDialog:_e,PsRadio2:fe,PsRadio:ue,StripePaymentModal:be,PaypalPaymentModal:ve,OfflinePaymentModal:ke,PsWarningDialog2:ye,InputEmailModal:Pe},setup(t,{emit:s}){const T=y(),K=y(),x=y(),W=y(),p=y(),O=y(),Y=y(),o=y(),P=Ie(),z=Ce(),b=new we,r=he(),B=new Ee,U=Ae(),N=Te(),a=Se().getLoginUserId(),f=y(0),S=y(""),A=y(""),R=y(!1);async function H(){T.value.toggle(!0),await z.resetPaidAdItemList(a),await P.packageListWithPurchasedCount(a),M();const e=await r.loadAppInfo(B);S.value=e.data.razorKey,e.status==Me.SUCCESS?f.value=parseInt(e.data.oneDay,10):f.value=0}function M(){P.packageList!=null&&P.packageList.data!=null&&P.packageList.data.length>0&&(o.value=P.packageList.data[0])}function le(e){if(o.value==null||o.value.paymentInfo==null){p.value.openModal("",u("select_package"));return}r.appInfo.data.mobileSetting.is_demo_for_payment==1?Y.value.openModal(u("payment__warning_title"),u("payment__confirm_message"),u("payment__ok"),u("credit_card_modal__cancel"),()=>{e=="PAYPAL"?q():e=="STRIPE"?Z():e=="RAZOR"?G():e=="PAYSTACK"?J():e=="OFFLINE"?X():e=="FLUTTERWAVE"&&(C.checkFlutterwaveCurrency(o.value.paymentAttributes.currencyShortForm)?Q():p.value.openModal("",u("core_fe__flutterwave_currency_not_supported",{attribute:o.value.paymentAttributes.currencyShortForm})))},()=>{C.log("Cancel")}):e=="PAYPAL"?q():e=="STRIPE"?Z():e=="RAZOR"?G():e=="PAYSTACK"?J():e=="OFFLINE"?X():e=="FLUTTERWAVE"&&(C.checkFlutterwaveCurrency(o.value.paymentAttributes.currencyShortForm)?Q():p.value.openModal("",u("core_fe__flutterwave_currency_not_supported",{attribute:o.value.paymentAttributes.currencyShortForm})))}function Z(){T.value.toggle(!1),K.value.openModal(()=>{const e=E.PAYMENT_STRIPE_METHOD.toString();F(e)},()=>{C.log("Cancel")})}async function F(e){var m;b.userId=a,b.packageId=(m=o.value.paymentInfo)==null?void 0:m.id,b.paymentMethod=e,b.paymentMethodNounce=localStorage.paymentNonce||"",b.price=o.value.paymentAttributes.price,b.razorId=A.value||"",b.currency=o.value.paymentAttributes.currencyShortForm;const n=await P.postPackageBought(a,b);T.value.toggle(!1),(n==null?void 0:n.code)==201?(R.value=e==E.PAYMENT_FLUTTERWAVE_METHOD.toString(),localStorage.paymentNonce="",location.reload()):(localStorage.paymentNonce="",p.value.openModal(u("ps_error_dialog__error"),n==null?void 0:n.message,u("core__fe_btn_ok"),()=>{location.reload()}))}function q(){T.value.toggle(!1),x.value.openModal(()=>{const e=E.PAYMENT_PAYPAL_METHOD.toString();F(e)},()=>{C.log("Cancel")})}async function G(){const n=(await U.loadUser(a)).data,m={key:S.value,amount:parseInt(o.value.paymentAttributes.price)*100,currency:o.value.paymentAttributes.currencyShortForm,name:u("home__banner_header"),prefill:{email:n.userEmail,name:n.userName,contact:n.userPhone},theme:{color:"#0e9f6e"},handler:async function(d){A.value=d.razorpay_payment_id,F(E.PAYMENT_RAZOR_METHOD.toString())}},_=new window.Razorpay(m);_.open(),_.on("payment.failed",function(d){})}async function J(){var _;const n=(await U.loadUser(a)).data;let m=n.userEmail;n.userEmail==""||n.userEmail==null?O.value.openModal(d=>{var D;m=d,ne.setup({key:(D=r==null?void 0:r.appInfo)==null?void 0:D.data.payStackKey,email:m,amount:parseInt(o.value.paymentAttributes.price)*100,currency:o.value.paymentAttributes.currencyShortForm,callback:async function(j){C.log(j),F(E.PAYMENT_PAY_STACK_METHOD.toString())},onClose:function(){}}).openIframe()},()=>{console.log("cancel")}):ne.setup({key:(_=r==null?void 0:r.appInfo)==null?void 0:_.data.payStackKey,email:m,amount:parseInt(o.value.paymentAttributes.price)*100,currency:o.value.paymentAttributes.currencyShortForm,callback:async function(I){C.log(I),F(E.PAYMENT_PAY_STACK_METHOD.toString())},onClose:function(){}}).openIframe()}async function se(e,n){var m,_,d;await N.verifyTransaction(a,e.transaction_id,""),console.log(N),((m=N.transaction)==null?void 0:m.data)!=null&&((d=(_=N.transaction)==null?void 0:_.data)==null?void 0:d.status)=="success"&&F(n)}async function Q(){var e,n;if(((e=r.appInfo.data)==null?void 0:e.flutterwavePublicKey)=="")p.value.openModal("",u("core_fe__update_flutterwave_public_key"));else{const m=E.PAYMENT_FLUTTERWAVE_METHOD.toString(),d=(await U.loadUser(a)).data;Re({amount:parseInt(o.value.paymentAttributes.price),callback(I){console.log(I),se(I,m)},country:"US",currency:o.value.paymentAttributes.currencyShortForm,customer:{email:d.userEmail,name:d.userName,phone_number:d.userPhone},customizations:{description:"Pay with "+u("home__banner_header"),logo:"",title:u("home__banner_header")},meta:{user_id:a,token:"jdjdjdjdjd"},onclose(){s("isPromoteSuccessful",R.value)},payment_options:"card",public_key:(n=r.appInfo.data)==null?void 0:n.flutterwavePublicKey,redirect_url:void 0,tx_ref:"tx_ref_"+Date.now()})}}function X(){T.value.toggle(!1),W.value.openModal(()=>{const e=E.PAYMENT_OFFLINE_METHOD.toString();F(e)},()=>{C.log("Cancel")})}function ie(e){var n,m,_,d,I,D,j,ee,te;if(e.toString()=="0")return u("item_price__free");if(((_=(m=(n=r==null?void 0:r.appInfo)==null?void 0:n.data)==null?void 0:m.mobileSetting)==null?void 0:_.price_format)==="###,###")return new Intl.NumberFormat("en-FR",{style:"decimal",useGrouping:!0,minimumFractionDigits:0}).format(e).replace(","," ");if(((D=(I=(d=r==null?void 0:r.appInfo)==null?void 0:d.data)==null?void 0:I.mobileSetting)==null?void 0:D.price_format)==="##,####"){let oe=parseFloat(e).toFixed(4).split("."),ae=oe.pop();return ae=oe[0],ae.replace(/(\d)(?=(\d{4})+$)/g,"$1,")}else return Ue((te=(ee=(j=r==null?void 0:r.appInfo)==null?void 0:j.data)==null?void 0:ee.mobileSetting)==null?void 0:te.price_format,e)}return{psmodal:T,openModal:H,packageprovider:P,appInfoStore:r,limitProvider:z,ps_error_dialog:p,stripe_payment_modal:K,paypal_payment_modal:x,offline_payment_modal:W,selected:o,ps_warning_dialog:Y,paymentClicked:le,input_email:O,formatPrice:ie}}}),Ye={class:"flex justify-between items-start"},ze={class:"flex flex-wrap"},He={class:"flex flex-col mt-1 sm:mt-7"},je={class:""},Ke={class:"flex flex-col w-full"},xe={class:"flex flex-col w-full mt-3 gap-2 sm:gap-4",id:"r1"},We={class:"font-light"},Be={class:"grid grid-cols-3 sm:grid-cols-3 gap-4 mt-6"},Ze={alt:"",class:"w-full h-full object-contain bottom-0"},qe={alt:"",class:"w-full h-full object-contain bottom-0"},Ge={alt:"",class:"w-full h-full object-contain bottom-0"},Je={alt:"",class:"w-full h-full object-contain bottom-0"},Qe=h("Offline"),Xe={alt:"",class:"w-full h-full object-contain bottom-0"};function et(t,s,T,K,x,W){const p=g("ps-label"),O=g("ps-icon"),Y=g("ps-radio-2"),o=g("ps-button"),P=g("ps-modal"),z=g("stripe-payment-modal"),b=g("paypal-payment-modal"),r=g("ps-warning-dialog-2"),B=g("offline-payment-modal"),U=g("ps-error-dialog"),N=g("input-email-modal"),$=Oe("lazy");return v(),re("div",null,[i(P,{ref:"psmodal",line:"hidden",maxWidth:"534px",isClickOut:!1,class:"h-full",bodyHeight:"max-h-75",theme:"px-4 py-8 sm:p-8 rounded-lg"},{title:l(()=>{var a,f,S,A;return[c("div",Ye,[((a=t.limitProvider.buyadList)==null?void 0:a.data)!=null&&((A=(S=(f=t.limitProvider.buyadList)==null?void 0:f.data[0])==null?void 0:S.user)==null?void 0:A.remainingPost)==0?(v(),w(p,{key:0,textColor:"text-lg font-semibold text-feSecondary-800 mb-2"},{default:l(()=>[h(k(t.$t("limit_item_modal__quota_running_out.")),1)]),_:1})):L("",!0),c("div",ze,[i(p,{class:"text-lg text-feSecondary-800 me-2"},{default:l(()=>[h(k(t.$t("limit_item_modal__limit")),1)]),_:1}),i(p,{class:"text-lg"},{default:l(()=>[h(k(t.$t("limit_item_modal__limit_post_buy")),1)]),_:1})]),i(O,{class:"cursor-pointer dark:text-feSecondary-500",name:"close",w:"24",h:"24",onClick:s[0]||(s[0]=R=>t.psmodal.toggle(!1))})])]}),body:l(()=>[c("div",He,[c("div",je,[c("div",Ke,[i(p,{class:"font-medium text-base"},{default:l(()=>[h(k(t.$t("promote_item_modal__choose_package")),1)]),_:1}),c("div",xe,[(v(!0),re(Le,null,Ne(t.packageprovider.packageList.data,a=>(v(),w(Y,{class:$e(["border px-2 py-2 rounded",{"border-fePrimary-500":t.selected===a}]),key:a.packageId,value:a,selectedValue:t.selected,"onUpdate:selectedValue":s[1]||(s[1]=f=>t.selected=f)},{title:l(()=>[c("div",null,[i(p,{class:"ms-2 pl-1 text-sm font-semibold text-feSecondary-800"},{default:l(()=>[h(k(a.paymentInfo.value),1)]),_:2},1024),i(p,{class:"ms-2 pl-1 mt-1 text-sm text-feSecondary-800"},{default:l(()=>[h(k(a.paymentAttributes.count)+" "+k(t.$t("limit_item_modal__post")),1)]),_:2},1024)])]),price:l(()=>[i(p,{class:"text-sm"},{default:l(()=>{var f;return[c("span",We,k((f=a.paymentAttributes)==null?void 0:f.currencySymbol),1),h(" "+k(t.formatPrice(a.paymentAttributes.price)),1)]}),_:2},1024)]),_:2},1032,["value","selectedValue","class"]))),128))])])])])]),footer:l(()=>{var a,f,S,A,R,H;return[i(p,{class:"mt-6 sm:mt-7 font-medium text-base"},{default:l(()=>[h(k(t.$t("promote_item_modal__pay_with")),1)]),_:1}),c("div",Be,[((a=t.appInfoStore.appInfo.data)==null?void 0:a.paypalEnable)=="1"?(v(),w(o,{key:0,colors:"bg-transparent dark:bg-feSecondary-50 h-16",border:"border hover:shadow",hover:"none",class:"",rounded:"rounded-lg",onClick:s[2]||(s[2]=M=>t.paymentClicked("PAYPAL"))},{default:l(()=>[V(c("img",Ze,null,512),[[$,{src:t.$page.props.sysImageUrl+"/paypal.png"}]])]),_:1})):L("",!0),((f=t.appInfoStore.appInfo.data)==null?void 0:f.stripeEnable)=="1"?(v(),w(o,{key:1,colors:"bg-transparent  dark:bg-feSecondary-50 h-16",border:"border hover:shadow",hover:"none",class:"",rounded:"rounded-lg",onClick:s[3]||(s[3]=M=>t.paymentClicked("STRIPE"))},{default:l(()=>[V(c("img",qe,null,512),[[$,{src:t.$page.props.sysImageUrl+"/stripe.png"}]])]),_:1})):L("",!0),((S=t.appInfoStore.appInfo.data)==null?void 0:S.razorEnable)=="1"?(v(),w(o,{key:2,colors:"bg-transparent dark:bg-feSecondary-50 h-16",border:"border hover:shadow",hover:"none",class:"",rounded:"rounded-lg",onClick:s[4]||(s[4]=M=>t.paymentClicked("RAZOR"))},{default:l(()=>[V(c("img",Ge,null,512),[[$,{src:t.$page.props.sysImageUrl+"/razorpay.png"}]])]),_:1})):L("",!0),((A=t.appInfoStore.appInfo.data)==null?void 0:A.payStackEnabled)=="1"?(v(),w(o,{key:3,colors:"bg-transparent dark:bg-feSecondary-50 h-16",border:"border hover:shadow",hover:"none",class:"",rounded:"rounded-lg",onClick:s[5]||(s[5]=M=>t.paymentClicked("PAYSTACK"))},{default:l(()=>[V(c("img",Je,null,512),[[$,{src:t.$page.props.sysImageUrl+"/paystack.png"}]])]),_:1})):L("",!0),((R=t.appInfoStore.appInfo.data)==null?void 0:R.offlineEnabled)=="1"?(v(),w(o,{key:4,colors:"bg-transparent dark:bg-feSecondary-50 h-16",class:"",border:"border hover:shadow",hover:"none",padding:"px-8 py-4",rounded:"rounded-lg",onClick:s[6]||(s[6]=M=>t.paymentClicked("OFFLINE"))},{default:l(()=>[i(O,{class:"dark:text-feSecondary-800 pr-1",name:"wallet",w:"20",h:"20"}),i(p,{textColor:" font-semibold"},{default:l(()=>[Qe]),_:1})]),_:1})):L("",!0),((H=t.appInfoStore.appInfo.data)==null?void 0:H.flutterwaveEnabled)=="1"?(v(),w(o,{key:5,colors:"bg-transparent dark:bg-feSecondary-50 h-16",border:"border hover:shadow",hover:"none",class:"",rounded:"rounded-lg",onClick:s[7]||(s[7]=M=>t.paymentClicked("FLUTTERWAVE"))},{default:l(()=>[V(c("img",Xe,null,512),[[$,{src:t.$page.props.sysImageUrl+"/flutterwave.png"}]])]),_:1})):L("",!0)])]}),_:1},512),i(z,{ref:"stripe_payment_modal"},null,512),i(b,{ref:"paypal_payment_modal"},null,512),i(r,{ref:"ps_warning_dialog"},null,512),i(B,{ref:"offline_payment_modal"},null,512),i(U,{ref:"ps_error_dialog"},null,512),i(N,{ref:"input_email"},null,512)])}var lo=De(Ve,[["render",et]]);export{lo as default};
